<!DOCTYPE html>
<head>
    <meta charset="UTF-8"
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURENT LTBWeb</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" crossorigin="" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-dialog@1.0.5/Leaflet.Dialog.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-sidebar-v2@3.2.1/css/leaflet-sidebar.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.8/src/leaflet-search.css">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/vega@5.6.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.0.0-beta.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@5.1.2"></script>
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js" crossorigin=""></script>
    <script>base64arraybuffer = exports = {};</script>
    <script src="https://unpkg.com/base64-arraybuffer@0.2.0/lib/base64-arraybuffer.js"></script>
    <script>exports = undefined</script>
    <script src="https://rawcdn.githack.com/greggman/twgl.js/0e14d352a4062e9c2242cd6fa971f738ad763a38/dist/4.x/twgl-full.min.js"></script>
    <script src="https://unpkg.com/d3-delaunay@5.1.3/dist/d3-delaunay.min.js"></script>
    <script src="../static/js/dime.js" type="text/javascript" crossorigin=""></script>
    <script src="../static/js/NDArray.js"></script>
    <script src="../static/js/CanvasLayer.js"></script>
    <script src="../static/js/TopologyLayer.js"></script>
    <script src="../static/js/TopMulti.js"></script>
    <script src="../static/js/ContMulti.js"></script>
    <script src="../static/js/PlayMulti.js"></script>
    <script src="../static/js/ContourLayer.js"></script>
    <script src="../static/js/CommunicationLayer.js"></script>
    <script src="../static/js/SearchLayer.js"></script>
    <script src="../static/js/ZoneLayer.js"></script>
    <script src="../static/js/ConfigControl.js"></script>
    <script src="../static/js/LayerControl.js"></script>
    <script src="../static/js/Window.js"></script>
    <script src="../static/js/TimeBox.js"></script>
    <script src="../static/js/PlaybackControl.js"></script>
    <script src="../static/js/Legend.js"></script>
    <script src="../static/js/Demo.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-dialog@1.0.5/Leaflet.Dialog.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-sidebar-v2@3.2.1/js/leaflet-sidebar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.8/dist/leaflet-search.src.min.js"></script>
</head>

<body>
    <div class="row">
        <div class="column" id="map1"></div>
        <div class="column" id="map2"></div>
    </div>
        <script>
            let options = [
                // Settings for map1
                {
                    dimehost: window.location.hostname,
                    dimeport: +window.location.port + 8,
                    vmin: 0.8,
                    vmax: 1.2,
                    amin: -1.0,
                    amax: 1.0,
                    fmin: 0.9998,
                    fmax: 1.0002,
                    opacity: 0.25
                },

                // Settings for map2
                {
                    dimehost: window.location.hostname,
                    dimeport: +window.location.port + 8,
                    vmin: 0.8,
                    vmax: 1.2,
                    amin: -1.0,
                    amax: 1.0,
                    fmin: 0.9998,
                    fmax: 1.0002,
                    opacity: 0.25
                }
            ];

            if (document.cookie !== "") {
                for (let option of options) { // TODO: fix this
                    document.cookie.split(';').map((d) => d.split('=')).reduce((acc, [k, v]) => { acc[k.trim()] = v.trim(); return acc; }, option);
                }
            }

            if (window.location.hash !== "") {
                for (let option of options) {
                    window.location.hash.substring(1).split(',').map((d) => d.split('=')).reduce((acc, [k, v]) => { acc[k] = decodeURI(v); return acc; }, option);
                }
            }

            const x1 = document.getElementById("map1");
            const x2 = document.getElementById("map2");

            const window1 = new Window(1, options[0]);
            const window2 = new Window(2, options[1]);

            window1.mainThread();
            window2.mainThread();

            function toggleSecondMap() {
                x2.style.display = (x2.style.display === "block" ? "none" : "block");

                window1.map.invalidateSize();
                window2.map.invalidateSize();
            }

            L.easyButton('<span>2nd</span>', toggleSecondMap).addTo(window1.map);

            // set the number of map views
            if (options.nview > 1) {
                toggleSecondMap();
            }
        </script>
    </div>

    <div id="agvis-demo" style="position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background-color: white; padding: 10px; border-radius: 5px; z-index: 9999;">
        <h2>Agvis Demo Environment</h2>
    </div>
    
    <div class="demo-buttons" id="demoButtons" style="z-index: 799">
        <!-- Demo Buttons -->
        <button class="demo-button" onclick="activateDemo(0)">WECC</button>
        <button class="demo-button" onclick="activateDemo(1)">NPCC</button>
        <button class="demo-button" onclick="activateDemo(2)">IEEE39</button>
        <button class="demo-button" onclick="activateDemo(3)">ERCOT276</button>
        <button class="demo-button" onclick="activateDemo(4)">EI528</button>
    </div>
</body>